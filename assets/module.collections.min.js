(function($){"use strict";theme.ProductsView=function(){function e(){this.selectors={view:".js-products-view"},$(this.selectors.view).length&&this.init()}e.prototype=$.extend({},e.prototype,{init:function(){var e=this,a=localStorage.getItem("products-view");if(-1!==window.location.href.indexOf("products-view=reset")&&(a=null,localStorage.setItem("products-view",null)),a){var t=$(this.selectors.view+" [data-js-products-grid-buttons]");a=JSON.parse(a),t.each((function(){var t=$(this),n=!0;$.each(a,(function(e,a){if(t.attr("data-value-"+e)!==a){var o="data-active-"+e;t.attr("data-value-"+e,a),t.find("[data-value]").removeAttr(o),t.find('[data-value="'+a+'"]').attr(o,!0),n=!1}})),n||e.update(t)}))}$body.on("click",this.selectors.view+" [data-js-products-grid-buttons] [data-value]",(function(){var a=$(this),t=a.parents("[data-js-products-grid-buttons]"),n=a.attr("data-value"),o=theme.current.bp,i="data-active-"+o;if(!a[0].hasAttribute(i)){var r={};t.find("[data-value]").removeAttr(i),a.attr(i,!0),t.attr("data-value-"+o,n),e.update(t),$.each(theme.breakpoints.values,(function(e,a){r[e]=t.attr("data-value-"+e)})),localStorage.setItem("products-view",JSON.stringify(r))}}))},update:function(e){var a=e.parents(this.selectors.view).find("[data-js-products]"),t=$("[data-js-products-grid-buttons]"),n="";t.length&&($.each(theme.breakpoints.values,(function(e){var o=t.attr("data-value-"+e),i="list"===o?12:12/+o;a[1==+o?"addClass":"removeClass"]("products-view-centered-"+e),a["list"===o?"addClass":"removeClass"]("products-view-list-"+e),n+=" col-","xs"!==e&&(n+=e+"-"),n+=i})),a.find("[data-js-product]").parent().attr("class",n),$window.trigger("checkImages"))}}),theme.ProductsView=new e},theme.Collections=function(){function Collections(){var e=$(".js-collections");this.dom={$collections:e,$body:e.find("[data-js-collections-body]"),$sidebar:$("[data-js-collection-sidebar]"),$pagination:e.find("[data-js-collection-pagination]")},this.current={xhr:null,handle:null},this.dom.$collections.length&&this.load()}Collections.prototype=$.extend({},Collections.prototype,{_parseURL:function(){var e=window.location.href.split(theme.routes.collections_url+"/")[1].split("?"),a=e[0].split("/"),t=e[1]?e[1].split("&"):void 0,n={handle:a[0],params:{tags:[],vendors:[],types:[],options:[],title:null,price_from:null,price_to:null,only_available_enable:null,logic_or_enable:null,page:null,view:null,sort_by:null}};return a[1]&&(n.params.tags=n.params.tags.concat(a[1].split("+"))),$.each(t,(function(e,a){var t=a.split("="),o=t[0],i=t[1];"constraint"===o?i.split("+").map((function(e){n.params.tags.push(decodeURIComponent(e.replace(/-/g," ")))})):"q"===o?$.each(i.split("+"),(function(e,a){var t=a.split("_:"),o=t[0],i=t[1];"tg"===o?n.params.tags.push(decodeURIComponent(i)):"vd"===o?n.params.vendors.push(decodeURIComponent(i)):"tp"===o?n.params.types.push(decodeURIComponent(i)):"opt"===o?(i=i.split("::"),n.params.options.push(decodeURIComponent(i[0])+"::"+decodeURIComponent(i[1]))):"tt"===o?n.params.title=decodeURIComponent(i):"prf"===o?n.params.price_from=i:"prt"===o?n.params.price_to=i:"oa"===o?n.params.only_available_enable="true"===i||"false"!==i&&null:"lo"===o?n.params.logic_or_enable="true"===i||"false"!==i&&null:"pg"===o&&(n.params.page=i)})):"view"===o?n.params.view=i:"sort_by"===o?n.params.sort_by=i:"page"===o&&(n.params.page=i)})),n},_buildURL:function(e){var a=theme.routes.collections_url+"/"+e.handle,t=a,n=[],o=[];function i(e,a){for(var t,n=[],o=0;o<e.length;o++)a?(t=e[o].split(a),n[o]=encodeURIComponent(t[0])+a+encodeURIComponent(t[1])):n[o]=encodeURIComponent(e[o]);return n}return!0===window.page.default.only_available||!0===window.page.default.logic_or||e.params.vendors.length||e.params.types.length||e.params.options.length||null!==e.params.title||null!==e.params.price_from||null!==e.params.price_to||null!=e.params.only_available_enable||null!=e.params.logic_or_enable?(n[0]=[],e.params.tags.length&&n[0].push("tg_:"+i(e.params.tags).join("+tg_:")),e.params.vendors.length&&n[0].push("vd_:"+i(e.params.vendors).join("+vd_:")),e.params.types.length&&n[0].push("tp_:"+i(e.params.types).join("+tp_:")),e.params.options.length&&n[0].push("opt_:"+i(e.params.options,"::").join("+opt_:")),null!==e.params.title&&n[0].push("tt_:"+encodeURIComponent(e.params.title)),null!==e.params.price_from&&n[0].push("prf_:"+e.params.price_from),null!==e.params.price_to&&n[0].push("prt_:"+e.params.price_to),null!==e.params.only_available_enable&&e.params.only_available_enable!==window.page.default.only_available&&n[0].push("oa_:"+e.params.only_available_enable),null!==e.params.logic_or_enable&&e.params.logic_or_enable!==window.page.default.logic_or&&n[0].push("lo_:"+e.params.logic_or_enable),null!==e.params.page&&1!==e.params.page&&n[0].push("pg_:"+e.params.page),n[0].length?n[0]="q="+n[0].join("+"):n=[]):(e.params.tags.length&&n.push("constraint="+i(e.params.tags.map((function(e){return e.replace(/ /g,"-")}))).join("+")),null!==e.params.page&&1!==e.params.page&&n.push("page="+e.params.page)),null!==e.params.sort_by&&e.params.sort_by!==window.page.default.sort_by&&n.push("sort_by="+e.params.sort_by),o=n.slice(),null!==e.params.view&&e.params.view!==window.page.default.view_length?(n.push("view="+e.params.view),o.push("view="+e.params.view+"-ajax")):o.push("view=ajax"),n.length&&(a+="?"+n.join("&")),{history:a,ajax:t+="?"+o.join("&")}},_changeURL:function(e,a){("onchange.pagination"!==a||"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type)&&history.pushState({foo:"filters"},e,e)},_changeObj:function(e,a,t,n){var o,i=$.extend(!0,{},e),r=i;return-1!==a.indexOf("params.")&&(r=i.params,a=a.replace("params.","")),"change"===t?r[a]=n:"add"===t?-1===r[a].indexOf(n)&&r[a].push(n):"remove"===t&&-1!==(o=r[a].indexOf(n))&&r[a].splice(o,1),i},_setControls:function(e){var a=window.page.default.only_available,t=window.page.default.logic_or;null!==e.params.only_available_enable&&(a=e.params.only_available_enable),null!==e.params.logic_or_enable&&(t=e.params.logic_or_enable),$('[name="collection"]').prop("checked",!1).filter('[value="'+e.handle+'"]').prop("checked","checked"),$('[name="collection_with_tag"], [name="filter_by_tag"], [name="filter_by_color"], [name="filter_by_vendor"], [name="filter_by_type"], [name="filter_by_option"]').prop("checked",!1),$('[name="filter_by_title"]').val(""),theme.RangeOfPrice&&theme.RangeOfPrice.reset(),$.each(e.params.tags,(function(e,a){$('[name="collection_with_tag"][value="'+a+'"]').prop("checked","checked"),$('[name="filter_by_tag"][value="'+a+'"]').prop("checked","checked"),$('[name="filter_by_color"][value="'+a+'"]').prop("checked","checked")})),$.each(e.params.vendors,(function(e,a){$('[name="filter_by_vendor"][value="'+a+'"]').prop("checked","checked")})),$.each(e.params.types,(function(e,a){$('[name="filter_by_type"][value="'+a+'"]').prop("checked","checked")})),$.each(e.params.options,(function(e,a){$('[name="filter_by_option"][value="'+a+'"]').prop("checked","checked")})),$('[name="filter_by_title"]').val(e.params.title?e.params.title:""),$('[name="only_available"]').prop("checked",!!a&&"checked"),$('[name="logic_or"]').prop("checked",!!t&&"checked"),$('[name="sort_by"]').val(null!==e.params.sort_by?e.params.sort_by:window.page.default.sort_by).trigger("update"),$('[name="view_length"]').val(null!==e.params.view?e.params.view:window.page.default.view_length).trigger("update"),theme.RangeOfPrice&&theme.RangeOfPrice.update(e.params.price_from,e.params.price_to)},_loadContent:function(url,obj,event){var _=this;this.current.xhr&&this.current.xhr.abort(),theme.Loader.set($('[data-js-collection-replace="products"]').parent(),{fixed:!0,spinner:!theme.current.is_mobile&&null}),this.xhr=$.ajax({type:"GET",url:url,cache:!1,dataType:"html",success:function(data){var parser=new DOMParser,$new_page=$(parser.parseFromString(data,"text/html")),replace_find="[data-js-collection-replace]",head_sections_arr=[];function stickyProcessAndDisable(){theme.StickySidebar&&theme.StickySidebar.update("listener-process"),theme.StickySidebar&&theme.StickySidebar.update("listener-disable")}theme.ProductsView&&theme.ProductsView.update($new_page.find("[data-js-products]")),_.current.handle===obj.handle&&(replace_find+=":not([data-js-collection-replace-only-full])"),theme.StickySidebar&&theme.StickySidebar.update("listener-enable"),$(replace_find).each((function(){var $this=$(this),name=$this.attr("data-js-collection-replace"),$element=$('[data-js-collection-replace="'+name+'"]'),$page_element=$new_page.find('[data-js-collection-replace="'+name+'"]'),$section;"onchange.pagination"!==event||"products"!==name||"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type?($element.replaceWith($page_element),$page_element[0].hasAttribute("data-js-collection-manual-visible")&&$page_element.parents("[data-js-collection-manual-visible-section]")["true"===$page_element.attr("data-js-collection-manual-visible")?"removeClass":"addClass"]("d-none-important"),$page_element[0].hasAttribute("data-js-collection-replace-hide-empty")&&($section=$page_element.parents("[data-js-collection-nav-section]"),$section[$page_element.find("input, [data-filter-type]").length?"removeClass":"addClass"]("d-none")),"fullwidth-head"===name||"head"===name?head_sections_arr.push($page_element.parents("[data-section-type]")):"products"===name?theme.Loader.unset($page_element.parent()):"js-settings"==name&&eval($page_element.text()),$element.remove()):($element.append($page_element.children()),"products"===name&&theme.Loader.unset($element.parent()))})),_.current.handle!==obj.handle&&($new_page.find("[data-js-collection-visible-element]").each((function(){var e=$(this),a=e.attr("data-js-collection-visible-element");$('[data-js-collection-visible-element="'+a+'"]')["true"===e.attr("data-js-collection-visible")?"removeClass":"addClass"]("d-none-important")})),null===obj.params.sort_by&&_.dom.$body.find('[name="sort_by"]').val(window.page.default.sort_by).trigger("update"),null===obj.params.view&&_.dom.$body.find('[name="view_length"]').val(window.page.default.view_length).trigger("update")),_.dom.$pagination=_.dom.$body.find("[data-js-collection-pagination]"),theme.current.is_mobile&&theme.Loader.unset(_.dom.$sidebar),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update(),theme.StoreLists.checkProductStatus(),theme.ProductCountdown.init(_.dom.$body.find(".js-countdown")),theme.ProductReview.update(),stickyProcessAndDisable(),head_sections_arr.length&&$(head_sections_arr).each((function(e,a){$(a).one("section:reloaded",(function(){theme.StickySidebar&&theme.StickySidebar.update(null,1)})).trigger("section.reload")})),theme.Tooltip&&theme.Tooltip.init(),$new_page.remove(),_.current.handle=obj.handle,_.current.xhr=null}})},_onChangeHistory:function(e){var a=this._buildURL(e);theme.current.is_mobile&&theme.Loader.set(this.dom.$sidebar,{fixed:!0}),this._setControls(e),this._loadContent(a.ajax,e)},_onChangeControls:function(e,a){var t=this._buildURL(e);theme.current.is_mobile&&theme.Loader.set(this.dom.$sidebar,{fixed:!0}),!0===window.page.default.reload_type_ajax?(this._changeURL(t.history,a),this._loadContent(t.ajax,e,a)):window.location.href=t.history},changePriceParams:function(e,a){var t=this._parseURL(),n=$.extend(!0,{},t);n=this._changeObj(n,"params.price_from","change",e),n=this._changeObj(n,"params.price_to","change",a),this._onChangeControls(n)},load:function(){var e=this;function a(a,t){var n=e._parseURL(),o=$.extend(!0,{},n),i=e.dom.$sidebar.find('[name="collection"]:checked').val();o=e._changeObj(o,"handle","change",i),o=e._changeObj(o,"params.page","change",null),a?(o=e._changeObj(o,"params.tags","change",[]),o=e._changeObj(o,"params.vendors","change",[]),o=e._changeObj(o,"params.types","change",[]),o=e._changeObj(o,"params.options","change",[]),o=e._changeObj(o,"params.title","change",null),o=e._changeObj(o,"params.price_from","change",null),o=e._changeObj(o,"params.price_to","change",null),$("[data-js-collection-current-tags] [data-filter-type]").remove(),$('[name="collection_with_tag"], [name="filter_by_tag"], [name="filter_by_color"], [name="filter_by_vendor"], [name="filter_by_type"], [name="filter_by_option"]').prop("checked",!1),$('[name="filter_by_title"]').val(""),theme.RangeOfPrice&&theme.RangeOfPrice.reset()):e.dom.$sidebar.find('[name="collection_with_tag"]').each((function(){var a=$(this),t=a.val();o=a.is(":checked")?e._changeObj(o,"params.tags","add",t):e._changeObj(o,"params.tags","remove",t)})),t&&t(o),e._onChangeControls(o)}function t(){var a=e._parseURL(),t=$.extend(!0,{},a),n=e.dom.$sidebar.find('[name="filter_by_title"]').val();t=e._changeObj(t,"params.page","change",null),t=n.length?e._changeObj(t,"params.title","change",n):e._changeObj(t,"params.title","change",null),e._onChangeControls(t)}this.dom.$sidebar.on("change",'[name="collection"]',(function(){a(!0)})),this.dom.$sidebar.on("change",'[name="collection_with_tag"]',(function(){var t=$(this),n=t.parents(".collections-menu__item").find('[name="collection"]'),o=$('[name="collection"]').not(n),i=n.is(":checked");o.prop("checked",!1),n.prop("checked","checked"),a(!i,(function(a){i||(t.prop("checked","checked"),a=$.extend(!0,a,e._changeObj(a,"params.tags","add",t.val())))}))})),this.dom.$sidebar.on("change",'[name="filter_by_tag"], [name="filter_by_color"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this),o=n.val();t=e._changeObj(t,"params.page","change",null),t=n.is(":checked")?e._changeObj(t,"params.tags","add",o):e._changeObj(t,"params.tags","remove",o),e._onChangeControls(t)})),this.dom.$sidebar.on("change",'[name="filter_by_vendor"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this),o=n.val();t=e._changeObj(t,"params.page","change",null),t=n.is(":checked")?e._changeObj(t,"params.vendors","add",o):e._changeObj(t,"params.vendors","remove",o),e._onChangeControls(t)})),this.dom.$sidebar.on("change",'[name="filter_by_type"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this),o=n.val();t=e._changeObj(t,"params.page","change",null),t=n.is(":checked")?e._changeObj(t,"params.types","add",o):e._changeObj(t,"params.types","remove",o),e._onChangeControls(t)})),this.dom.$sidebar.on("change",'[name="filter_by_option"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this),o=n.val();t=e._changeObj(t,"params.page","change",null),t=n.is(":checked")?e._changeObj(t,"params.options","add",o):e._changeObj(t,"params.options","remove",o),e._onChangeControls(t)})),this.dom.$sidebar.on("change",'[name="only_available"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this);t=e._changeObj(t,"params.page","change",null),t=e._changeObj(t,"params.only_available_enable","change",n.is(":checked")),e._onChangeControls(t)})),this.dom.$sidebar.on("change",'[name="logic_or"]',(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this);t=e._changeObj(t,"params.page","change",null),t=e._changeObj(t,"params.logic_or_enable","change",n.is(":checked")),e._onChangeControls(t)})),this.dom.$sidebar.on("click","[data-js-collection-filter-by-title] button",(function(){t()})),this.dom.$sidebar.on("keyup","[data-js-collection-filter-by-title] input",$.debounce(700,(function(){t()}))),this.dom.$sidebar.on("click","[data-js-collection-current-tags] [data-filter-type]",(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this),o=$(this).attr("data-filter-type"),i=n.attr("data-value");t=e._changeObj(t,"params.page","change",null),"tg"===o?t=e._changeObj(t,"params.tags","remove",i):"vd"===o?t=e._changeObj(t,"params.vendors","remove",i):"tp"===o?t=e._changeObj(t,"params.types","remove",i):"opt"===o?t=e._changeObj(t,"params.options","remove",i):"tt"===o?t=e._changeObj(t,"params.title","change",null):"pr"===o&&(t=e._changeObj(t,"params.price_from","change",null),t=e._changeObj(t,"params.price_to","change",null)),e._setControls(t),e._onChangeControls(t),n.remove()})),this.dom.$sidebar.on("click","[data-js-collection-current-tags-clear]",(function(){var a=e._parseURL(),t=$.extend(!0,{},a);t=e._changeObj(t,"params.tags","change",[]),t=e._changeObj(t,"params.vendors","change",[]),t=e._changeObj(t,"params.types","change",[]),t=e._changeObj(t,"params.options","change",[]),t=e._changeObj(t,"params.title","change",null),t=e._changeObj(t,"params.price_from","change",null),t=e._changeObj(t,"params.price_to","change",null),t=e._changeObj(t,"params.page","change",null),e._setControls(t),e._onChangeControls(t),e.dom.$sidebar.find("[data-js-collection-current-tags] [data-filter-type]").remove()})),this.dom.$body.on("change","[data-js-collection-sort-by] select",(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this);t=e._changeObj(t,"params.page","change",null),t=e._changeObj(t,"params.sort_by","change",n.val()),e._onChangeControls(t)})),this.dom.$body.on("change","[data-js-collection-view-length] select",(function(){var a=e._parseURL(),t=$.extend(!0,{},a),n=$(this);t=e._changeObj(t,"params.page","change",null),t=e._changeObj(t,"params.view","change",n.val()),e._onChangeControls(t)})),this.dom.$body.on("click","[data-js-collection-pagination] a",(function(a){var t,n=e._parseURL(),o=$.extend(!0,{},n),i=$(this),r=i.attr("data-value")||i.attr("href").split("page=")[1].split("&")[0];return $('[name="page"]').val(r),o=e._changeObj(o,"params.page","change",r>1?r:null),e._onChangeControls(o,"onchange.pagination"),"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type&&!0===window.page.default.reload_type_ajax&&(t=theme.StickyHeader&&theme.StickyHeader.$sticky?theme.StickyHeader.$sticky.stickyHeader("getStickyHeight"):0,$html.add($body).velocity("stop").velocity("scroll",{offset:e.dom.$body.find("[data-js-products]").offset().top-t,duration:1e3*theme.animations.pagination.scroll_duration})),a.preventDefault(),!1})),this.dom.$pagination.length&&"infinite_scroll"===window.page.default.pagination_type&&setTimeout((function(){$window.on("scroll",(function(){e.dom.$pagination[0].getBoundingClientRect().top<theme.current.height&&!e.dom.$pagination[0].hasAttribute("data-js-loading")&&(e.dom.$pagination.attr("data-js-loading",!0),e.dom.$pagination.find("a").trigger("click"))}))}),500),!0===window.page.default.reload_type_ajax&&$window.on("popstate",(function(){var a=e._parseURL();e._onChangeHistory(a)}))}}),theme.Collections=new Collections},$((function(){theme.ProductsView(),theme.Collections()}))})(jQueryTheme);